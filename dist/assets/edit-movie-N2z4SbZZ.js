import{a as d,j as e,T as D,z as l,M,B as H,v as A,K as F}from"./TextField-C0C35B0s.js";import{D as L,C as P,a as I,b as $,H as B}from"./admin-BtXtYjBH.js";import{S as N}from"./Stack-DDPYJlOQ.js";import{S as O}from"./Snackbar-DD-lInE4.js";import{A as U}from"./Alert-B1AO4k1G.js";function z({movieId:o}){const[t,p]=d.useState({film_name:"",film_img:"",film_trailer:"",Release_date:"",film_describe:"",age_limit:"",duration:"",film_type:"1",categories:"",directors:"",actors:""}),[W,g]=d.useState(!0),[f,c]=d.useState({open:!1,message:"",severity:"success"}),k=[{value:"1",label:"Đang chiếu"},{value:"0",label:"Sắp chiếu"}],_=()=>c(n=>({...n,open:!1}));d.useEffect(()=>{(async()=>{var s,i,m,b,y,j,x,v,C,S,T,w;try{const h=await fetch(`/api/admin/films/detail/${o}`);if(!h.ok)throw new Error("Failed to fetch movie details");const a=await h.json(),R=Array.isArray((s=a.film[0])==null?void 0:s.film_img)?a.film[0].film_img:[((i=a.film[0])==null?void 0:i.film_img)||""],E=(m=a.film[0])!=null&&m.Release_date?new Date(a.film[0].Release_date).toISOString().split("T")[0]:"";p({film_name:((b=a.film[0])==null?void 0:b.film_name)||"",film_img:R.join(", "),film_trailer:((y=a.film[0])==null?void 0:y.film_trailer)||"",Release_date:E,film_describe:((j=a.film[0])==null?void 0:j.film_describe)||"",age_limit:((x=a.film[0])==null?void 0:x.age_limit)||"",duration:((v=a.film[0])==null?void 0:v.duration)||"",film_type:((C=a.film[0])==null?void 0:C.film_type.toString())||"1",categories:((S=a.categories)==null?void 0:S.map(u=>u.category_name).join(", "))||"",directors:((T=a.directors)==null?void 0:T.map(u=>u.director_name).join(", "))||"",actors:((w=a.actors)==null?void 0:w.map(u=>u.actor_name).join(", "))||""}),g(!1)}catch(h){console.error(h),c({open:!0,message:"Lỗi khi tải thông tin phim",severity:"error"}),g(!1)}})()},[o]);const r=n=>{const{name:s,value:i}=n.target;p(m=>({...m,[s]:i}))},q=async n=>{n.preventDefault();const s={...t,film_img:t.film_img.split(",").map(i=>i.trim()),categories:t.categories.split(",").map(i=>i.trim()),directors:t.directors.split(",").map(i=>i.trim()),actors:t.actors.split(",").map(i=>i.trim())};try{const i=await fetch(`/api/admin/films/edit/${o}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!i.ok)throw new Error("Failed to update movie");const m=await i.json();c({open:!0,message:"Phim đã được cập nhật thành công!",severity:"success"})}catch{c({open:!0,message:"Có lỗi xảy ra khi cập nhật phim!",severity:"error"})}};return e.jsxs(L,{children:[e.jsxs(P,{children:[e.jsx(I,{title:e.jsx(D,{variant:"h2",children:"Chỉnh sửa thông tin phim"})}),e.jsx($,{children:W?e.jsx(D,{variant:"body1",children:"Đang tải thông tin phim..."}):e.jsxs("form",{onSubmit:q,children:[e.jsxs(N,{spacing:3,children:[e.jsx(l,{name:"film_name",label:"Tên phim",value:t.film_name,onChange:r,required:!0,fullWidth:!0}),e.jsx(l,{name:"film_img",label:"URL hình ảnh (cách nhau bởi dấu phẩy)",value:t.film_img,onChange:r,required:!0,fullWidth:!0}),e.jsx(l,{name:"film_trailer",label:"URL trailer",value:t.film_trailer,onChange:r,required:!0,fullWidth:!0}),e.jsx(l,{name:"Release_date",label:"Ngày phát hành",type:"date",InputLabelProps:{shrink:!0},value:t.Release_date,onChange:r,required:!0,fullWidth:!0}),e.jsx(l,{name:"film_describe",label:"Mô tả",value:t.film_describe,onChange:r,multiline:!0,rows:4,required:!0,fullWidth:!0}),e.jsx(l,{name:"age_limit",label:"Giới hạn độ tuổi",type:"number",value:t.age_limit,onChange:r,required:!0,fullWidth:!0}),e.jsx(l,{name:"duration",label:"Thời lượng (phút)",type:"number",value:t.duration,onChange:r,required:!0,fullWidth:!0}),e.jsx(l,{name:"film_type",label:"Trạng thái phim",select:!0,value:t.film_type,onChange:r,required:!0,fullWidth:!0,children:k.map(n=>e.jsx(M,{value:n.value,children:n.label},n.value))}),e.jsx(l,{name:"categories",label:"Thể loại (cách nhau bởi dấu phẩy)",value:t.categories,onChange:r,fullWidth:!0}),e.jsx(l,{name:"directors",label:"Đạo diễn (cách nhau bởi dấu phẩy)",value:t.directors,onChange:r,fullWidth:!0}),e.jsx(l,{name:"actors",label:"Diễn viên (cách nhau bởi dấu phẩy)",value:t.actors,onChange:r,fullWidth:!0})]}),e.jsx(H,{mt:3,display:"flex",justifyContent:"flex-end",children:e.jsx(A,{type:"submit",variant:"contained",color:"primary",children:"Cập nhật"})})]})})]}),e.jsx(O,{open:f.open,autoHideDuration:6e3,onClose:_,children:e.jsx(U,{onClose:_,severity:f.severity,children:f.message})})]})}function X(){const{id:o}=F();return e.jsxs(e.Fragment,{children:[e.jsx(B,{children:e.jsxs("title",{children:[" ","Chỉnh sửa thông tin phim | Trang quản trị website bán vé xem phim NHTT"]})}),e.jsx(z,{movieId:o})]})}export{X as default};
