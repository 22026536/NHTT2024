import{a as o,y as D,j as e,T as b,z as u,B as m,v as j,M as v,K as k}from"./TextField-C0C35B0s.js";import{D as E,C as F,a as H,b as W,H as q}from"./admin-BtXtYjBH.js";import{S as I}from"./Stack-DDPYJlOQ.js";import{S as P}from"./Snackbar-DD-lInE4.js";import{A as U}from"./Alert-B1AO4k1G.js";function $({userId:i}){const[t,c]=o.useState({username:"",user_img:null,email:"",phone_number:"",role:0,status:0}),[g,y]=o.useState(""),C=[{label:"Người dùng",value:0},{label:"Quản trị viên",value:1}],S=[{label:"Đang hoạt động",value:1},{label:"Không hoạt động",value:0}],[p,x]=o.useState(!0),[h,d]=o.useState({open:!1,message:"",severity:"success"}),T=D(),f=()=>d(a=>({...a,open:!1}));o.useEffect(()=>{(async()=>{try{const n=await fetch(`/api/admin/users/detail/${i}`);if(!n.ok)throw new Error("Failed to fetch user details");const s=(await n.json()).user[0]||{};c({username:s.username||"",user_img:null,email:s.email||"",phone_number:s.phone_number||"",role:s.role||0,status:s.status||0}),y(s.user_img||""),x(!1)}catch(n){console.error(n),d({open:!0,message:"Lỗi khi tải thông tin người dùng",severity:"error"}),x(!1)}})()},[i]);const l=a=>{const{name:n,value:r}=a.target;c(s=>({...s,[n]:r}))},_=a=>{const n=a.target.files[0];c(r=>({...r,user_img:n}))},w=async a=>{a.preventDefault();const n=new FormData;n.append("username",t.username),n.append("email",t.email),n.append("phone_number",t.phone_number),n.append("role",t.role),n.append("status",t.status),t.user_img&&n.append("user_img",t.user_img);try{const r=await fetch(`/api/admin/users/edit/${i}`,{method:"PATCH",body:n});if(!r.ok)throw new Error("Failed to update user");const s=await r.json();d({open:!0,message:"Thông tin người dùng đã được cập nhật thành công!",severity:"success"}),setTimeout(()=>T(-1),1e3)}catch{d({open:!0,message:"Có lỗi xảy ra khi cập nhật thông tin người dùng!",severity:"error"})}};return e.jsx(E,{children:e.jsxs(F,{children:[e.jsx(H,{title:e.jsx(b,{variant:"h2",children:"Chỉnh sửa thông tin người dùng"})}),e.jsx(W,{children:p?e.jsx(b,{variant:"body1",children:"Đang tải thông tin người dùng..."}):e.jsxs("form",{onSubmit:w,children:[e.jsxs(I,{spacing:3,children:[e.jsx(u,{fullWidth:!0,label:"Tên người dùng",name:"username",value:t.username,onChange:l,required:!0}),e.jsx(u,{fullWidth:!0,label:"Email",name:"email",type:"email",value:t.email,onChange:l,required:!0}),e.jsxs(m,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:2},children:[g&&e.jsx(m,{children:e.jsx("img",{src:g,alt:"Current Profile",style:{display:"block",width:"100%",maxWidth:"200px",borderRadius:"8px",margin:"0 auto"}})}),e.jsxs(j,{variant:"outlined",component:"label",size:"small",sx:{color:"gray",borderColor:"gray",textTransform:"none"},children:["Tải ảnh đại diện",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:_})]})]}),e.jsx(u,{fullWidth:!0,label:"Số điện thoại",name:"phone_number",value:t.phone_number,onChange:l,required:!0}),e.jsx(u,{fullWidth:!0,select:!0,label:"Vai trò",name:"role",value:t.role,onChange:l,children:C.map(a=>e.jsx(v,{value:a.value,children:a.label},a.value))}),e.jsx(u,{fullWidth:!0,select:!0,label:"Trạng thái",name:"status",value:t.status,onChange:l,children:S.map(a=>e.jsx(v,{value:a.value,children:a.label},a.value))})]}),e.jsx(m,{mt:3,display:"flex",justifyContent:"flex-end",children:e.jsx(j,{type:"submit",variant:"contained",color:"primary",disabled:p,children:"Cập nhật"})})]})}),e.jsx(P,{open:h.open,autoHideDuration:6e3,onClose:f,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(U,{onClose:f,severity:h.severity,sx:{width:"100%"},children:h.message})})]})})}function K(){const{id:i}=k();return e.jsxs(e.Fragment,{children:[e.jsx(q,{children:e.jsxs("title",{children:[" ","Chỉnh sửa thông tin người dùng | Trang quản trị website bán vé xem phim NHTT"]})}),e.jsx($,{userId:i})]})}export{K as default};
